<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Van Elst Werkbon v24</title>
    
    <link rel="icon" type="image/png" href="logo_van_elst.png">
    <link rel="apple-touch-icon" href="logo_van_elst.png">

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#2d4d36">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; padding: 10px; color: #333; margin: 0; }
        .container { max-width: 650px; margin: auto; display: none; }
        .login-container { max-width: 350px; margin: 80px auto; text-align: center; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .logo-header { text-align: center; margin-bottom: 20px; min-height: 80px; }
        .logo-header img { max-width: 220px; height: auto; border-radius: 8px; display: block; margin: 0 auto; }
        .card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; border-top: 4px solid #2d4d36; }
        h2 { margin: 0 0 10px 0; color: #2d4d36; border-bottom: 1px solid #eee; padding-bottom: 8px; font-size: 1.1em; text-transform: uppercase; }
        label { display: block; margin-top: 10px; font-weight: 600; font-size: 0.85em; color: #444; }
        input, textarea, select { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 16px; background: #fff; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .totaal-box { background: #f0f4f1; padding: 12px; border-radius: 8px; margin-top: 10px; text-align: center; font-weight: bold; color: #2d4d36; }
        .btn-send { background: #2d4d36; color: white; border: none; padding: 18px; width: 100%; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 15px; }
        .btn-loc { background: #6c757d; color: white; border: none; padding: 10px; border-radius: 8px; font-size: 13px; margin-top: 8px; cursor: pointer; width: 48%; }
        hr { border: 0; border-top: 1px dashed #ddd; margin: 15px 0; }
        #map-overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:1000; }
        #map-container { width:95%; height:85%; margin:5% auto; background:white; border-radius:15px; position:relative; overflow:hidden; }
        #map { width:100%; height:100%; }
        .map-close { position:absolute; top:10px; right:10px; background:#2d4d36; color:white; padding:12px; border-radius:8px; font-weight:bold; cursor:pointer; z-index:1001; }
        .load-input-group { display: flex; gap: 5px; align-items: center; }
        .load-input-group input { flex: 2; }
        .load-input-group select { flex: 1; min-width: 70px; }
    </style>
</head>
<body>

<div id="login-box" class="login-container">
    <div class="logo-header">
        <img src="./logo_van_elst.png" alt="Van Elst Logo" id="logo1">
    </div>
    <input type="password" id="pincode" placeholder="Pincode" style="text-align:center;">
    <button class="btn-send" onclick="checkCode()">INLOGGEN</button>
</div>

<div id="app-content" class="container">
    <div class="logo-header">
        <img src="./logo_van_elst.png" alt="Van Elst Logo" id="logo2">
    </div>
    
    <div class="card">
        <h2>Dagoverzicht</h2>
        <label>Medewerker</label>
        <input type="text" id="medewerker" placeholder="Typ je naam...">
        <div class="grid-3">
            <div><label>Start</label><input type="time" id="dag_start" onchange="calc()"></div>
            <div><label>Eind</label><input type="time" id="dag_eind" onchange="calc()"></div>
            <div><label>Pauze (min)</label><input type="number" id="dag_pauze" value="0" onchange="calc()"></div>
        </div>
        <div class="totaal-box">Totaal Dagtijd: <span id="totaalDagUren">0:00</span></div>
    </div>

    <div id="klanten-container"></div>

    <div class="card"><button class="btn-send" onclick="verstuurMail()">üìß WERKBON VOORBEREIDEN</button></div>
</div>

<div id="map-overlay"><div id="map-container"><div class="map-close" onclick="closeMap()">OPSLAAN</div><div id="map"></div></div></div>

<script>
    let currentKlantIndex = 0;
    let map, marker;

    function checkCode() {
        if (document.getElementById('pincode').value === "1234") {
            document.getElementById('login-box').style.display = 'none';
            document.getElementById('app-content').style.display = 'block';
            initMap();
        } else { alert("Foutieve code"); }
    }

    // Klanten genereren
    const container = document.getElementById('klanten-container');
    for (let i = 1; i <= 5; i++) {
        container.innerHTML += `
            <div class="card">
                <div style="background:#2d4d36; color:white; padding:4px 12px; border-radius:20px; display:inline-block; font-size:0.8em; margin-bottom:10px;">KLANT ${i}</div>
                <label>Klant</label><input type="text" id="klant_naam_${i}">
                <label>Locatie</label><input type="text" id="klant_locatie_${i}">
                <div style="display:flex; justify-content:space-between;">
                    <button class="btn-loc" onclick="geolocate(${i})">üìç GPS</button>
                    <button class="btn-loc" onclick="openMap(${i})" style="background:#2d4d36;">üõ∞Ô∏è Satelliet</button>
                </div>
                <label>Werkzaamheden</label><textarea id="klant_werk_${i}" rows="2"></textarea>
                <div class="grid-3">
                    <div><label>Start</label><input type="time" id="k_start_${i}" onchange="calcK(${i})"></div>
                    <div><label>Eind</label><input type="time" id="k_eind_${i}" onchange="calcK(${i})"></div>
                    <div><label>Pauze (min)</label><input type="number" id="k_pauze_${i}" value="0" onchange="calcK(${i})"></div>
                </div>
                <div class="totaal-box">Projecturen: <span id="totaal_k_${i}">0:00</span></div>
                <hr>
                <label>Machine</label><input type="text" id="machine_${i}">
                <div class="grid-2">
                    <div><label>Wacht (min)</label><input type="number" id="w_tijd_${i}"></div>
                    <div><label>Reden</label><select id="w_type_${i}"><option>Wachten</option><option>Defect</option><option>Anders</option></select></div>
                </div>
                <div class="grid-2">
                    <div><label>Laden</label><div class="load-input-group"><input type="text" id="l_h_${i}" placeholder="Tekst..."><select id="l_e_${i}"><option>m3</option><option>Ton</option><option>kg</option></select></div></div>
                    <div><label>Lossen</label><div class="load-input-group"><input type="text" id="lo_h_${i}" placeholder="Tekst..."><select id="lo_e_${i}"><option>m3</option><option>Ton</option><option>kg</option></select></div></div>
                </div>
            </div>
        `;
    }

    function initMap() {
        map = L.map('map').setView([51.712, 5.869], 16); 
        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', { attribution: 'Esri' }).addTo(map);
        marker = L.marker([51.712, 5.869], {draggable: true}).addTo(map);
    }

    function openMap(i) {
        currentKlantIndex = i;
        document.getElementById('map-overlay').style.display = 'block';
        setTimeout(() => { 
            map.invalidateSize();
            navigator.geolocation.getCurrentPosition((pos) => {
                const latlng = [pos.coords.latitude, pos.coords.longitude];
                map.setView(latlng, 19);
                marker.setLatLng(latlng);
            }, null, {enableHighAccuracy: true});
        }, 300);
    }

    function closeMap() {
        const pos = marker.getLatLng();
        document.getElementById(`klant_locatie_${currentKlantIndex}`).value = pos.lat.toFixed(6) + "," + pos.lng.toFixed(6);
        document.getElementById('map-overlay').style.display = 'none';
    }

    function geolocate(i) {
        navigator.geolocation.getCurrentPosition((pos) => {
            document.getElementById(`klant_locatie_${i}`).value = pos.coords.latitude.toFixed(6) + "," + pos.coords.longitude.toFixed(6);
        });
    }

    function bereken(s, e, p) {
        if (!s || !e) return "0:00";
        let startMin = (parseInt(s.split(':')[0]) * 60) + parseInt(s.split(':')[1]);
        let eindMin = (parseInt(e.split(':')[0]) * 60) + parseInt(e.split(':')[1]);
        let totaalMin = eindMin - startMin - (parseInt(p) || 0);
        if (totaalMin < 0) totaalMin = 0;
        let h = Math.floor(totaalMin / 60);
        let m = totaalMin % 60;
        return h + ":" + (m < 10 ? '0' : '') + m;
    }
    
    function calc() { document.getElementById('totaalDagUren').innerText = bereken(document.getElementById('dag_start').value, document.getElementById('dag_eind').value, document.getElementById('dag_pauze').value); }
    function calcK(i) { document.getElementById(`totaal_k_${i}`).innerText = bereken(document.getElementById(`k_start_${i}`).value, document.getElementById(`k_eind_${i}`).value, document.getElementById(`k_pauze_${i}`).value); }

    function verstuurMail() {
        const med = document.getElementById('medewerker').value || "Onbekend";
        const vandaag = new Date().toLocaleDateString('nl-NL');
        let details = "WERKBON VAN ELST\nDatum: " + vandaag + "\nMedewerker: " + med + "\n\n";
        
        for(let i=1; i<=5; i++) {
            let n = document.getElementById("klant_naam_" + i).value;
            if(n) {
                let loc = document.getElementById("klant_locatie_" + i).value;
                details += "KLANT " + i + ": " + n + "\n";
                if(loc) details += "Locatie: https://www.google.com/maps?q=" + loc + "\n";
                details += "Uren: " + document.getElementById("totaal_k_" + i).innerText + " (Pauze: " + (document.getElementById("k_pauze_" + i).value || 0) + " min)\n";
                if(document.getElementById("machine_" + i).value) details += "Machine: " + document.getElementById("machine_" + i).value + "\n";
                if(document.getElementById("w_tijd_" + i).value) details += "Wachttijd: " + document.getElementById("w_tijd_" + i).value + " min (" + document.getElementById("w_type_" + i).value + ")\n";
                if(document.getElementById("l_h_" + i).value) details += "Laden: " + document.getElementById("l_h_" + i).value + " " + document.getElementById("l_e_" + i).value + "\n";
                if(document.getElementById("lo_h_" + i).value) details += "Lossen: " + document.getElementById("lo_h_" + i).value + " " + document.getElementById("lo_e_" + i).value + "\n";
                details += "Werkzaamheden: " + document.getElementById("klant_werk_" + i).value + "\n\n";
            }
        }
        window.location.href = "mailto:?subject=Werkbon " + vandaag + " - " + med + "&body=" + encodeURIComponent(details);
    }
</script>
</body>
</html>
